<!DOCTYPE html>
<html>
<head>
    <title>Sub-Metric Analysis Viewer</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; background: #f0f2f5; color: #333; }
        .container { max-width: 1200px; margin: auto; }
        .item { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 8px 30px rgba(0,0,0,0.12); margin-bottom: 30px; }
        
        .nav-controls { display: flex; justify-content: center; align-items: center; gap: 15px; margin-bottom: 25px; position: sticky; top: 10px; z-index: 100; }
        button { padding: 12px 28px; font-size: 15px; cursor: pointer; border-radius: 8px; border: none; background: #2563eb; color: white; font-weight: 600; transition: all 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        button:hover { background: #1d4ed8; transform: translateY(-1px); }
        button:disabled { background: #cbd5e1; cursor: not-allowed; transform: none; }
        #page-info { font-weight: bold; background: white; padding: 10px 20px; border-radius: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

        .header { display: flex; justify-content: space-between; align-items: flex-end; border-bottom: 3px solid #e2e8f0; padding-bottom: 15px; margin-bottom: 20px; }
        .rank { font-size: 1.8em; font-weight: 800; color: #1e293b; }
        .impact { font-size: 1.1em; font-weight: bold; color: #dc2626; background: #fee2e2; padding: 5px 15px; border-radius: 20px; }
        
        .img-container { background: #f8fafc; border-radius: 12px; padding: 15px; margin-bottom: 25px; text-align: center; border: 1px solid #e2e8f0; }
        img { max-width: 100%; max-height: 550px; height: auto; border-radius: 5px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .filename-text { color: #64748b; font-size: 0.95em; margin-top: 12px; font-family: monospace; }
        
        table { width: 100%; border-collapse: collapse; background: white; font-size: 14px; }
        th, td { border: 1px solid #e2e8f0; padding: 10px 8px; text-align: center; }
        th { background: #f1f5f9; color: #475569; font-weight: 700; position: sticky; top: 0; }
        
        .group-header { background: #f8fafc; font-weight: bold; text-align: left; padding-left: 15px; color: #2563eb; border-left: 4px solid #2563eb; }
        
        .col-metric { width: 90px; }
        .col-score { width: 60px; }
        .col-impact { width: 100px; }
        .col-reason { text-align: left; line-height: 1.4; min-width: 400px; }
        
        .reason-box { background: #fff; padding: 8px; border-radius: 4px; border: 1px solid #f1f5f9; }
        .neg { color: #ef4444; font-weight: bold; }
        .pos { color: #10b981; }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="text-align: center; color: #1e293b; margin-bottom: 30px;">Figure Sub-Metric Analysis</h1>
        
        <div class="nav-controls">
            <button id="prev-btn" onclick="changePage(-1)">◀ Previous Outlier</button>
            <span id="page-info">Loading...</span>
            <button id="next-btn" onclick="changePage(1)">Next Outlier ▶</button>
        </div>

        <div id="content">Loading JSON data...</div>

        <div class="nav-controls" style="margin-top: 30px;">
            <button id="prev-btn-2" onclick="changePage(-1)">◀ Previous</button>
            <button id="next-btn-2" onclick="changePage(1)">Next ▶</button>
        </div>
    </div>

    <script src="data.js"></script>
    <script>
        let rankingData = [];
        let allImages = {};
        let currentIndex = 0;

        // 매핑 수정: Informativeness(q1), Fidelity(q2), Overall Readability(q3), Design Quality(q4), Creativity(q5)
        const metricGroups = {
            'q1.1': 'Informativeness (q1)',
            'q2.1': 'Fidelity (q2)',
            'q3.1': 'Overall Readability (q3)',
            'q4.1': 'Design Quality (q4)',
            'q5.1': 'Creativity (q5)'
        };

        async function init() {
            try {
                const response = await fetch('ranking_data_submetrics.json');
                rankingData = await response.json();
                
                if(window.PAPER_DATA) {
                    window.PAPER_DATA.forEach(p => p.images.forEach(img => allImages[img.filename] = img));
                }

                if(rankingData.length > 0) {
                    renderItem(0);
                } else {
                    document.getElementById('content').innerHTML = "No data found in ranking_data_submetrics.json";
                }
            } catch(e) {
                document.getElementById('content').innerHTML = "Error loading JSON: " + e.message + "<br>Make sure the file exists in the same directory.";
            }
        }

        function renderItem(index) {
            const item = rankingData[index];
            const container = document.getElementById('content');
            const imgInfo = allImages[item.filename] || { path: '', caption: 'No Caption' };
            
            let rows = '';
            for(const [m, d] of Object.entries(item.details)) {
                if(metricGroups[m]) {
                    rows += `<tr><td colspan="5" class="group-header">${metricGroups[m]}</td></tr>`;
                }

                rows += `<tr>
                    <td><strong>${m}</strong></td>
                    <td>${d.llm_score}</td>
                    <td>${d.human_score}</td>
                    <td class="${d.impact < 0 ? 'neg' : 'pos'}">${d.impact.toFixed(6)}</td>
                    <td class="col-reason"><div class="reason-box">${d.reason || '<span style="color:#ccc">No reason available</span>'}</div></td>
                </tr>`;
            }

            container.innerHTML = `
                <div class="item">
                    <div class="header">
                        <span class="rank">Rank #${index + 1} <small style="font-size: 0.6em; color: #64748b;">(Worst Correlation Impact)</small></span>
                        <span class="impact">Total Combined Impact: ${item.Total_Impact_Combined.toFixed(6)}</span>
                    </div>
                    <div class="img-container">
                        <img src="${imgInfo.path}" onerror="this.src='https://via.placeholder.com/800x400?text=Image+Not+Found'">
                        <div class="filename-text">File: ${item.filename}</div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th class="col-metric">Metric</th>
                                <th class="col-score">LLM</th>
                                <th class="col-score">Human</th>
                                <th class="col-impact">Impact Δ</th>
                                <th>Sub-Metric Explanation (Reason)</th>
                            </tr>
                        </thead>
                        <tbody>${rows}</tbody>
                    </table>
                </div>
            `;

            document.getElementById('page-info').innerText = `Outlier ${index + 1} / ${rankingData.length}`;
            document.querySelectorAll('#prev-btn, #prev-btn-2').forEach(b => b.disabled = (index === 0));
            document.querySelectorAll('#next-btn, #next-btn-2').forEach(b => b.disabled = (index === rankingData.length - 1));
            
            window.scrollTo(0, 0);
        }

        function changePage(offset) {
            currentIndex += offset;
            if(currentIndex < 0) currentIndex = 0;
            if(currentIndex >= rankingData.length) currentIndex = rankingData.length - 1;
            renderItem(currentIndex);
        }

        init();
    </script>
</body>
</html>